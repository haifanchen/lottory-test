<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>NIO Summer'25 è¶…çº§æŠ½å¥–</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;padding:20px;background:#f5f7fa;display:flex;justify-content:center;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
.card{max-width:400px;width:100%;background:#fff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.08);overflow:hidden}
.banner{width:100%;display:block;height:auto}
.content{padding:25px 30px 30px}
h2{margin-top:0;text-align:center}
label{display:block;margin-bottom:6px;font-weight:bold}
input{width:100%;padding:8px 10px;border:1px solid #cfd8e3;border-radius:4px;font-size:16px;box-sizing:border-box}
button{margin-top:16px;width:100%;padding:10px 0;border:none;border-radius:4px;background:#3f51b5;color:#fff;font-size:16px;cursor:pointer}
button:disabled{background:#c0c8e6;cursor:not-allowed}
#result{margin-top:20px;font-size:18px;font-weight:bold;text-align:center}
#result.success{color:#27ae60}
#result.fail{color:#e74c3c}
#submitBtn{background:#27ae60}
</style>
</head>
<body>
<div class="card">
<img class="banner" src="banner.jpeg">
<div class="content">
  <h2>NIO Summer'25 è¶…çº§æŠ½å¥–</h2>
  <label>è¯·è¾“å…¥ä¸‹å•æ‰‹æœºå·ï¼š</label>
  <input id="phoneInput" type="text" placeholder="11ä½æ‰‹æœºå·" maxlength="11">
  <button id="drawBtn" onclick="handleInput()">ç«‹å³æŠ½å¥–ï¼</button>
  <div id="result" style="display:none;"></div>
  <button id="submitBtn" style="display:none;margin-top:16px" onclick="goToForm()">å¡«å†™é¢†å¥–ä¿¡æ¯</button>
</div>
</div>

<script>
const DEADLINE  = new Date('2025-08-30 23:59:59');
const FEISHU_FORM_URL = 'https://nio.feishu.cn/share/base/form/shrcn61DZYEMObb4QDUaMma813d';
const SEED      = 20250805;
const usedHashes = new Set(JSON.parse(localStorage.getItem('usedHashes') || '[]'));

/* ===== å¥–å“æ±  ===== */
const PRIZE_POOL = [
  { name:'ã€7æœˆå†²åˆºäº«æ•´å¹´å…è´¹æ¢ç”µåˆ¸ã€‘', stock:3 },
  { name:'ã€è”šæ¥æ‚¦äº«å‡ºè¡Œå…‘æ¢åˆ¸ã€‘', stock:31 },
  { name:'ã€NIO SUMMERå¥—ç¥¨ã€‘', stock:30 },
  { name:'ã€æ£®æ³Šæ°´ä¹å›­è¶…çº§å¥—ç¥¨ã€‘', stock:10 },
  { name:'ã€NIO LIFEè¡Œæç®±ã€‘', stock:17 },
  { name:'ã€ç±³å®¶æ‰«åœ°æœºå™¨äººã€‘', stock:1 },
  { name:'ã€æ˜Ÿå·´å…‹å…‘æ¢åˆ¸ã€‘', stock:146 },
  { name:'ã€5å¼ å…è´¹æ¢ç”µåˆ¸ã€‘', stock:100 },
  { name:'ã€è›‡å¹´ipé©¬å…‹æ¯ã€‘', stock:382 }
];

/* ===== æ´—ç‰Œç®—æ³• ===== */
function shuffle(arr, seed) {
  let rng = seed;
  const random = () => {
    rng = (rng * 9301 + 49297) % 233280;
    return rng / 233280;
  };
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* ğŸ”¥é«˜äº®ğŸ”¥ æ‰‹æœºå·åˆ—è¡¨ â†’ SHA-256 æ‘˜è¦ï¼ˆå‰ 16 ä½ï¼‰æ˜ å°„ */
const HASH_LIST = [
  'f8c47e2e3b7a2e0e','3a4d7f2e9d5b8c5f','2e9c8b8a7f1d3e4d','4c2e8a5f9b1c3d4e','5e9b7c2a8f1d3e4f',
  '7b8e4a2c9f3e5d4a','6a9d4b3e8c2f5e1d','8c2f6a8e4b3d5f9a','9e3f7a2b8c4d5e6f','1b4e8a5c9f2d3e7f',
  '2c5f9a7b8e4d3f5a','3d6e9b2a8c5f4e3d','4e7f9a2b8c5d4e3f','5f8e9a2b7c4d3e5f','6a9f8b2c7e4d3f5a',
  '7b8a9f2e8c4d5e3f','8c9a8f2e7b4d5e6f','9e8a7f2e8c4d5e3f','1f2a8e7d9c4b3d5e','2f3b9a8e7c4d5e3f',
  '3f4c8a9e7c4d5e3f','4f5d9a8e7c4d5e3f','5f6e8a9e7c4d5e3f','6f7e9a8e7c4d5e3f','7f8e9a8e7c4d5e3f',
  '8f9e8a9e7c4d5e3f','9fae8a9e7c4d5e3f','1abe8a9e7c4d5e3f','2bce8a9e7c4d5e3f','3cde8a9e7c4d5e3f',
  '4def8a9e7c4d5e3f','5eff8a9e7c4d5e3f','6f0e8a9e7c4d5e3f','7f1e8a9e7c4d5e3f','8f2e8a9e7c4d5e3f',
  '9f3e8a9e7c4d5e3f','0f4e8a9e7c4d5e3f','1f5e8a9e7c4d5e3f','2f6e8a9e7c4d5e3f','3f7e8a9e7c4d5e3f'
];

/* ç”Ÿæˆå¥–å“æ•°ç»„ï¼ˆå¾ªç¯å¡«å……ï¼‰ */
let prizes = [];
PRIZE_POOL.forEach(p => {
  for (let i = 0; i < p.stock; i++) prizes.push(p.name);
});
const shuffled = shuffle([...prizes], SEED);

/* æ˜ å°„ï¼šå“ˆå¸Œ â†’ å¥–å“ï¼ˆå¾ªç¯å¡«å……ï¼‰ */
const PRIZE_MAP = {};
HASH_LIST.forEach((hash, idx) => {
  PRIZE_MAP[hash] = shuffled[idx % shuffled.length];
});

/* ===== ä¸šåŠ¡é€»è¾‘ ===== */
function isExpired() { return Date.now() > DEADLINE.getTime(); }

async function handleInput() {
  const phone = document.getElementById('phoneInput').value.trim();
  const drawBtn   = document.getElementById('drawBtn');
  const resultBox = document.getElementById('result');
  const submitBtn = document.getElementById('submitBtn');

  resultBox.style.display = 'none';
  submitBtn.style.display = 'none';

  if (!/^\d{11}$/.test(phone)) { showMessage('è¯·è¾“å…¥æ­£ç¡®çš„11ä½æ‰‹æœºå·', false); return; }

  const hash = await sha256(phone).slice(0, 16);
  if (!PRIZE_MAP[hash]) { showMessage('æ‰‹æœºå·æœªåœ¨æ´»åŠ¨èŒƒå›´å†…', false); return; }

  drawBtn.style.display = 'none';
  const prize = PRIZE_MAP[hash];
  const text  = usedHashes.has(hash) ? `å·²æŠ½è¿‡å¥–ï¼š${prize}` : `æ­å–œè·å¾—ï¼š${prize}`;
  showMessage(text, true);
  submitBtn.style.display = 'block';

  if (!usedHashes.has(hash)) {
    usedHashes.add(hash);
    localStorage.setItem('usedHashes', JSON.stringify([...usedHashes]));
  }
}

function showMessage(text, success) {
  const box = document.getElementById('result');
  box.textContent = text;
  box.className   = success ? 'success' : 'fail';
  box.style.display = 'block';
}

function goToForm() {
  window.open(FEISHU_FORM_URL, '_blank');
}

/* ===== SHA-256 æ‘˜è¦ï¼ˆæµè§ˆå™¨åŸç”Ÿï¼‰ ===== */
async function sha256(message) {
  const msgUint8 = new TextEncoder().encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}
</script>
</body>
</html>
